language: bash

globals:
    build_dir: public

commands:

    setup:
        description: Prepare environment
        exec: mkdir -p ${build_dir}

    assets:
        description: Install static assets
        dependencies:
            - setup
        exec: |
            cp -rf src/static/* ${build_dir}/

    wikis:
        description: Pull out documentation documents
        exec: |
            git submodule update --init --recursive --remote

    pages:
        description: Compile templates into HTML
        language: python3
        dependencies:
            - setup

    facade:
        description: Merge fragments into facade
        language: python3
        dependencies:
            - setup
            - pages

    strip:
        description: Clean up output directory
        dependencies:
            - setup
        exec: |
            find ${build_dir} -type f \
                -not -name 'index.html' \
                -not -name '*.jpg' \
                -not -name '*.png' \
                -not -name '*.gif' -delete

    minify:
        description: Minify generated files
        dependencies:
            - facade
            - strip
            - assets

    generate:
        description: Generate website pages
        dependencies:
            - setup
            - pages
            - facade
            - strip
            - assets
            - minify
        exec: echo -n

    clean:
        description: Clean up
        exec: rm -rf ${build_dir}
